Desvendando o Gato do ALV â€“ Veja como Funciona!
Autor: Mauricio Cruz
Data: 02/02/2011 07:30

O meu grande amigo Mauro, sabiamente, mostrou no post de ontem como funciona o
â€œGato do ALVâ€
comÂ o
cÃ³digo de game
para mostrar um relatÃ³rio sobre a consistÃªncia de um alv.
Eu fiquei
â€œfuÃ§andoâ€
um pouco e descobri como a coisa toda funciona. Vou explicar Ã  grosso modo, para simplificar as coisas:
â€“
Quando vocÃª segura aqueles botÃµes (SHIFT+ALT+CTRL) e dÃ¡ o duplo clique, o framework da SAPGUI reage, transformando esse comando maluco em um â€œ
sy-ucomm
â€ (aliÃ¡s, eu acho que o framework faz isso para qualquer aÃ§Ã£o do usuÃ¡rio).
â€“
Com esse
sy-ucomm
gerado, o SAP direciona o programa para um mÃ©todo da classe
CL_GUI_ALV_GRID
que se chama
CONSISTENCY_CHECK
(mÃ©todo PRIVATE)
â€“ Esse mÃ©todo chama a funÃ§Ã£o
ALV_CONSISTENCY_CHECK,
que mostra aquele log bonitÃ£o do post do Mauro, mostrando a consistÃªncia do ALV.
Parou parouâ€¦.
FunÃ§Ã£o?!?
Isso que dizer que eu posso codificar isso no meu relatÃ³rio? ğŸ˜®
Sim!
Fiz um ALV utilizando classes para exemplificar. Veja o cÃ³digo abaixo:
REPORT zaz_consistencia_alv.

* Objetos Para Referencia
DATA: o_alv    TYPE REF TO cl_gui_alv_grid,
      o_cont   TYPE REF TO cl_gui_docking_container,
      o_parent TYPE REF TO cl_gui_container.

* Tabela com os dados Mestres
DATA: t_flight TYPE TABLE OF sflight.

*----> Classe para tratar o evento de Duplo Clique do ALV

*----------------------------------------------------------------------*
*       CLASS lcl_event DEFINITION
*----------------------------------------------------------------------*
CLASS lcl_event DEFINITION.

  PUBLIC SECTION.
    METHODS handle_double_click
        FOR EVENT double_click OF cl_gui_alv_grid.

ENDCLASS.                    "lcl_event DEFINITION
*----------------------------------------------------------------------*
*       CLASS lcl_event IMPLEMENTATION
*----------------------------------------------------------------------*
CLASS lcl_event IMPLEMENTATION.

  METHOD handle_double_click.

*   DeclaraÃ§Ãµes do MÃ©todo
    DATA: t_fcat TYPE lvc_t_fcat,
          wa_layout TYPE lvc_s_layo,
          v_variant TYPE disvariant,
          v_save TYPE char1.

*   Busca os valores do ALV que estÃ¡ sendo exibido
    o_alv->get_frontend_fieldcatalog( IMPORTING
                                       et_fieldcatalog = t_fcat ).

    o_alv->get_frontend_layout( IMPORTING
                                 es_layout = wa_layout ).

    o_alv->get_variant( IMPORTING
                          es_variant = v_variant
                          e_save     = v_save ).

*   FunÃ§Ã£o que mostra a consistÃªncia do seu ALV
    CALL FUNCTION 'ALV_CONSISTENCY_CHECK'
      EXPORTING
        i_save     = v_save
        is_layo    = wa_layout
        is_variant = v_variant
        it_fcat    = t_fcat
        it_outtab  = t_flight.

  ENDMETHOD.                    "handle_double_click

ENDCLASS.                    "lcl_event IMPLEMENTATION

* Esta declaraÃ§Ã£o deve ficar apÃ³s a declaraÃ§Ã£o da Classe Local
DATA:  o_event  TYPE REF TO lcl_event.

*--------------------------------------------------------------------*
* Evento START-OF-SELECTION
*--------------------------------------------------------------------*
START-OF-SELECTION.

* Eu utilizei a SFLIGHT pois ela normalmente Ã© usada nos exemplos dos
* programas de exemplo de ALVs (BCALV* na SE38) Se vocÃª quiser
* pode trocar para outra tabela.
  SELECT * FROM sflight INTO TABLE t_flight.

* Crie essa tela e descomente o mÃ³dulo status_9000 OUTPUT.
  CALL SCREEN 9000.

*&---------------------------------------------------------------------*
*&      Module  STATUS_9000  OUTPUT
*&---------------------------------------------------------------------*
MODULE status_9000 OUTPUT.

* TÃ©cnica para vocÃª nÃ£o ter que desenhar o container na tela nova
* Essa classe cria o container pra vocÃª, e depois nÃ³s referenciamos
* estre container para o objeto do ALV OO.

* Cria o Container para a tela do ALV
  CREATE OBJECT o_cont
    EXPORTING
      side      = cl_gui_docking_container=>dock_at_top
      repid     = sy-repid
      dynnr     = '9000'
      extension = 1000
    EXCEPTIONS
      OTHERS    = 6.

* Casting para o tipo genÃ©rio
  o_parent = o_cont.

* Criia InstÃ¢ncia do ALV, referenciando o Container gerado acima
  CREATE OBJECT o_alv
    EXPORTING
      i_parent = o_parent.

* Registra tratamento do Evento de Duplo Clique
  CREATE OBJECT o_event.
  SET HANDLER o_event->handle_double_click FOR o_alv.

* Exibe o ALV
  CALL METHOD o_alv->set_table_for_first_display
    EXPORTING
      i_structure_name = 'SFLIGHT'
    CHANGING
      it_outtab        = t_flight.

ENDMODULE.                 " STATUS_9000  OUTPUT
Importante: Para o cÃ³digo acima funcionar, vocÃª deve criar uma tela de nÃºmero 9000 e descomentar o mÃ³dulo do PBO (status_9000 OUTPUT).
Fora a criaÃ§Ã£o da tela, Ã© sÃ³ dar ctrl+c ctrl+v num program local. Use o /H para ver como funciona!
O que vai acontecer:
Quando vocÃª rodar o programa, irÃ¡ aparecer esse ALV sem status gui nem nada, mas nÃ£o importa. Agora, vocÃª pode dar duplo clique em qualquer lugar do relatÃ³rio...
... que ele vai mostrar a mesma consistÃªncia do post do Mauro. VocÃª pode colocar essa consistÃªncia em qualquer lugar: num botÃ£o, numa aÃ§Ã£o por sy-ucomm do status_gui, em outro evento...
Pois Ã©,
Gato desvendado!
VocÃª pode usar o post como exemplo para ALV OO tambÃ©m ğŸ™‚
AbraÃ§os a todos aqueles que destroem o sonho das crianÃ§as que acreditam em mÃ¡gica (evil).



ComentÃ¡rios:
Marcos (09/03/2021 17:37): olÃ¡, ajudou muito este post, queria saber se consigo ajustar este mesmo cÃ³digo para usar ele com uma linha selecionavel grande abraÃ§o
Fabiana Rocha (26/04/2018 15:18): Oiâ€¦. estou com um problema e nÃ£o consigo uma soluÃ§Ã£o. Ao executar o ALV, criar uma linha e entrar com os dados (sem dar enter) somente com tab e depois clicar no botÃ£o SALVAR, a linha criada fica com os dados da linha antes dela. Se tiver um erro, irÃ¡ fazer a checagem mostrando o erro., acerto porÃ©m nÃ£o dou ENTER e clico no SALVAR,  dados gravados porÃ©m errados. como fazer para o programa entender o ENTER (que funciona corretamente) fazer a mesma coisa se nÃ£o clicar
  Leonel Sanches (23/01/2019 10:07): Fabiana, Use o mÃ©todo check_changed_data do prÃ³prio classe do ALV que irÃ¡ obter todas as alteraÃ§Ãµes. Ex: CALL METHOD o_alv->check_changed_data.
  Leonel Sanches (23/01/2019 10:07): Fabiana, Use o mÃ©todo check_changed_data do prÃ³prio classe do ALV que irÃ¡ obter todas as alteraÃ§Ãµes. Ex: CALL METHOD o_alv->check_changed_data.