Nota Fiscal EletrÃ´nica (NFe) â€“ Upgrade sem segredos
Autor: Mauricio Cruz
Data: 07/02/2011 13:35

EntÃ£o vocÃª Ã© daqueles que vÃª â€œaqueleâ€ e-mail com a sua nova alocaÃ§Ã£o e pensa: â€œFerrou! NÃ£o sei nada de NFe, muito menos do upgrade da versÃ£o 1.0 para a 2.0â€¦ Danou-se!â€. Pois Ã©, parece eu uns tempos atrÃ¡s ğŸ™
Mas a boa notÃ­cia Ã© que
tudo que vocÃª precisa
pode ser encontrado em dois lugares: No site da SAP e pelo Google. Eu passei bastante tempo pesquisando e encontrei bastante coisa bacana para guiar os Consultores na implantaÃ§Ã£o.
Como agora temos o nosso blog, nada mais justo do que compartilhar as informaÃ§Ãµes que eu achei sobre
o upgrade para a versÃ£o 2.0
. Vamos lÃ¡!
* Se o seu sistema nÃ£o utiliza o GRC para conectar-se a SEFAZ, esse post nÃ£o foi feito pra vocÃª. Pretendo criar posts com sugestÃµes para uma implantaÃ§Ã£o desse tipo no futuro ğŸ™‚
Manual do Contribuinte
Antes de mais nada, adquira imediatamente uma cÃ³pia em .pdf do Manual do Contribuinte
neste link
. Ele vai ajudÃ¡-lo em diversos problemas, pois contÃ©m o mapemaento de todos os campos do layout 2.0, alÃ©m das amarraÃ§Ãµes que existem no XML (Ex.: A mensagem X irÃ¡ aparecer se o campo Y nÃ£o for informado). Extremamente Ãºtil e extremamente necessÃ¡rio para qualquer implantaÃ§Ã£o.
Notas SAP
Tudo comeÃ§a na anÃ¡lise de algumas
notas da SAP
que contÃ©m as informaÃ§Ãµes sobre o upgrade. SÃ£o elas:
1438295
â€“ Guia TÃ©cnico para alteraÃ§Ãµes NFe 2.0
1465726
â€“ Â ConfiguraÃ§Ãµes para GRC no Layout 2.0
Nessa Ãºltima nota, a 1465726, a SAP disponibiliza um arquivo anexo que contÃ©m o passo-a-passo das alteraÃ§Ãµes de devem ser feitas na instÃ¢ncia PI do GRC. Ã‰ muito importante seguir os passos descritos no anexo, para vocÃª nÃ£o apanhar com besteiras nas fases de testes e homologaÃ§Ã£o.
Clique aqui
para visualizÃ¡-lo.
Uma outra nota importante Ã© a nota que mostra o caminho para os links onde Ã© possÃ­vel
visualizar todas as notas dos suporte packages
de NFe (SLL-NFe 1.0).
1487119
â€“ Acessando os Support Packages no Portal da SAP
Essa nota explica especificamente para o SP15, mas vocÃª pode ver de qualquer um, Ã© sÃ³ serÂ um pouquinho esperto ğŸ˜›
AlteraÃ§Ãµes Parte ABAP
Com a alteraÃ§Ã£o do layout, provavelmente vocÃª terÃ¡ que adicionar algumas consistÃªncias na BADI que preenche os dados nos campos da NFe, antes dela ser enviada ao GRC.
BADI
: CL_NFE_PRINT
AÃ­ vocÃª pode fazer consistÃªncias e modificar os valores da NFe que serÃ¡ enviada ao GRC.
Como eu faÃ§o para saber que o campo X no SAP Ã© o campo Y no manual do contribuinte?
â€“ Analise as tabelas
/XNFE/FLDVALID
e
/XNFE/NFEVALID
no GRC. Essas tabelas fazem parte do validador do GRC, e contÃ©m uma espÃ©cie de de-para do campo SAP com o campo do Manual do Contribuinte.
â€“ Abra a funÃ§Ã£o
J_1B_NF_MAP_TO_XML
e dÃª um FIND (CTRL+F) pelo nome do campo do manual do contribuinte (Ex. B02). NÃ£o se esqueÃ§a de fazer a busca no modo Â â€œGlobal no Programa BÃ¡sicoâ€. A funÃ§Ã£o Ã© bem comentada com relaÃ§Ã£o Ã  numeraÃ§Ã£o dos campos, entÃ£o fica fÃ¡cil de achar.
Interpretando Erros do GRC
ImpossÃ­vel nÃ£o citar dois fÃ³runs que sÃ£o direcionados somente Ã  discussÃ£o da implantaÃ§Ã£o de NFe e SPED no SAP. SÃ£o eles:
FÃ³rum NFe do SDN:
Aqui vocÃª pode tirar suas dÃºvidas com quem conhece MESMO a soluÃ§Ã£o. Pelo que eu entendi, parte dos moderadores dessa sala ajudou a criar a soluÃ§Ã£o de NFe da SAP, portanto os caras manjam muito disso tudo.
FÃ³rum LocalizaÃ§Ã£o Brasil:
um fÃ³rum menor e independente que tem bastante informaÃ§Ã£o bacana sobre soluÃ§Ã£o de problemas.
Em ambos, procure pelo cÃ³digo do erro e provavelmente vocÃª vai achar diversos tÃ³picos relacionados. DaÃ­ Ã© garimpar a soluÃ§Ã£o e ser feliz ğŸ˜€
Dicas e outras fontes de informaÃ§Ã£o
Utilize o
fÃ³rum do SDN
antes de se matar analisando um problema. Ele Ã© muito completo e tem muita muita informaÃ§Ã£o Ãºtil. E se mesmo assim vocÃª nÃ£o encontrar a resposta, Ã© sÃ³ postar que o pessoal normalmente responde rÃ¡pido.
Para a galera do PI, impossÃ­vel implantar com tranquilidade sem o guia com os
links dos Webservices e Actions da SEFAZ.
SÃ³ nÃ£o vale confundir ProduÃ§Ã£o com HomologaÃ§Ã£o na hora de preencher os Canais de ComunicaÃ§Ã£o heim! hehe.
AliÃ¡s, o trabalho que o Henrique Pinto desenvolveu no seu
Wiki de NFe
Ã© sensacional. EstÃ¡ tudo ali, Ã© sÃ³ ler ğŸ™‚
O mesmo Henrique tambÃ©m
fez um guia longo
sobre a determinaÃ§Ã£o dinÃ¢mica de destinatÃ¡rios de e-mail atravÃ©s de umas RFCs e umas alteraÃ§Ãµes nos objetos importados no PI. Eu achei bem Ãºtil, jÃ¡ vi implantado e funciona muito bem!
Ah, e se vocÃª estiver pensando em implantar a soluÃ§Ã£o de NFe em seu sistema, sempre tente atualizar o seu sistema com o
Ãºltimo Support Package disponÃ­vel
. O SP15, por exemplo, contÃ©m diversas falhas que sÃ£o corrigidas nos SPs 16 e 17. Portanto, para nÃ£o ter dor-de-cabeÃ§a procurando notas, aplique sempre o Ãºltimo SP disponÃ­vel. A nota 1487119 ali em cima tem o caminho para vocÃª analisar os SPs.
Este Ã© um compilado de informaÃ§Ãµes que eu acho Ãºteis para fazer a migraÃ§Ã£o para o layout 2.0 da NFe sem muita crise.
Claro que muitas outras notas, um nÃºmero gigantesco de posts por aÃ­ sobre o assuntoâ€¦ mas este compilado Ã© para guiar aqueles caras que caÃ­ram de gaiato no meio de um projeto de upgrade, que nem eu uns tempos atrÃ¡s ğŸ˜‰
DÃºvidas Ã© sÃ³ postar (ou visite o fÃ³rum do SDN. LÃ¡ tem tudo, Ã© sÃ©rio hahaha ğŸ˜› )!
AbraÃ§os!



ComentÃ¡rios:
jorge (27/10/2016 11:32): â€œSe o seu sistema nÃ£o utiliza o GRC para conectar-se a SEFAZ, esse post nÃ£o foi feito pra vocÃª. Pretendo criar posts com sugestÃµes para uma implantaÃ§Ã£o desse tipo no futuroâ€ Ola, sobre o tema acima, vc chegou a escrever alguma coisa? grato
Genilda Rocha (05/03/2013 21:07): Poderia me ajudar: Onde configuro na aba mensagem da Nota Fiscal Eletronica o texto do IPI, para aparecer em Dados Adcionais na hora da impressÃ£o. Obrigada. Genilda
Leonardo (16/01/2012 22:43): Caramba! Acho que vou fechar o LeoABAP.com.br!!! Nem dÃ¡ pra criar posts super legais assim! rs Ã“timo Cruz, parabÃ©ns! abs LÃ©o
  Mauricio Cruz (23/01/2012 07:22): Hahahah claro que nÃ£o po ğŸ™‚ Quanto mais blogs, mais informaÃ§Ãµes pra galera. Obrigado pelos parabÃ©ns! AbraÃ§os!
  Mauricio Cruz (23/01/2012 07:22): Hahahah claro que nÃ£o po ğŸ™‚ Quanto mais blogs, mais informaÃ§Ãµes pra galera. Obrigado pelos parabÃ©ns! AbraÃ§os!
Maikel Calgaroto (27/04/2011 06:34): Excepcional meu amigoâ€¦. You are PHODA!!!! ğŸ˜€ abraÃ§osss Maikel
Henrique Pinto (10/02/2011 11:57): Bem, jÃ¡ que fui citado, para que eu nao o processo por direitos autorais de uso de minha imagem (:-P), vou te pedir pra vc gerar uma pÃ¡gina no Wiki do SCN com esse guia de migraÃ§Ã£o. ğŸ™‚ NÃ³s criamos uma seÃ§Ã£o em PortuguÃªs no wiki que estÃ¡ sendo finalizada e estarÃ¡ liberada ao pÃºblico nas proximas semanas, daÃ­ vc poderÃ¡ criar lÃ¡ uma pÃ¡gina com esse guia. Combinado? ğŸ˜€
Victor Clemente (07/02/2011 11:22): Post feito pra mim o/ || /'
  mauricio.cruz (07/02/2011 11:41): Pior que ele foi a inspiraÃ§Ã£o mesmo O_O heoauheouaheouah
  mauricio.cruz (07/02/2011 11:41): Pior que ele foi a inspiraÃ§Ã£o mesmo O_O heoauheouaheouah