Relacionamento BOL
Autor: Priscila Silva
Data: 22/02/2011 11:23

Oi pessoas! Como o Mauricio disse no post em que me apresentou no blog, eu vou publicar algumas coisas referentes ao meu aprendizado nesse mundo CRM/BOL/BSP. Ent√£o, hoje acordei inspirada com a vit√≥ria do meu Tim√£o em cima do peixe no domingo¬†(haha) e escolhi como tema para o meu primeiro post : o ‚ÄúRelacionamento¬†BOL‚Äù.
Ai voc√™ me pergunta: ‚ÄúO que diabos √© o BOL? Aaah j√° sei Brasil online n√©? Eu j√° tive um e-mail desse um dia!‚Äù. N√ÉO¬†sr. espertinho!!! De forma bem resumida o BOL (Business Object Layer) armazena informa√ß√µes dos Objetos de Neg√≥cio, como Parceiros de Neg√≥cio, Ordens de Venda, etc. ¬†E algo que ajuda bastante nos desenvolvedores¬†√© que √© poss√≠vel ‚ÄúNavegar‚Äù atrav√©s das rela√ß√µes existentes entre os objetos para obter algumas informa√ß√µes espec√≠ficas,( NADA DE FICAR DANDO SELECTS POR AI), tudo o que voc√™ precisa (ou quase tudo)¬†j√° est√° na mem√≥ria¬† voc√™ s√≥ deve identificar¬†como chegar a esta informa√ß√£o e ler!! :). Como exemplo, vamos pegar um n√≥ com o cabe√ßalho de um documento e a partir dele encontrar o status do mesmo:
Componente/Vis√£o
: BT116H_SRVO/OVViewSet
Acessar a Classe de Implementa√ß√£o do n√≥ BTADMNH:
Na classe,¬†selecionar a aba
Atributos
e¬†procurar a constante ‚ÄúBASE_ENTITY_NAME‚Äù:
Com o valor inicial¬† ‚ÄòBTADMINH‚Äôencontrado na¬†constante¬†, acessar a transa√ß√£o
GENIL_MODEL_BROWSER
(Neste caso o nome do n√≥ √© igual ao valor do atributo, mas nem queira dar uma de espertinho porque nem todos os casos s√£o assim üòõ )
Procurar pelo modelo com nome igual √† ‚ÄòBTAdminH‚Äô:
Expandindo o n√≥
Rela√ß√µes
voc√™ encontrar√° todas as rela√ß√µes pelas quais pode navegar , para o nosso exemplo iremos utilizar¬† ‚ÄòBTHeaderStatusSet‚Äô. Expandindo¬†o n√≥
Estrutura do atributo
voc√™ encontrar√° a estrutura do mesmo e consecutivamente todas as informa√ß√µes que pode obter neste objeto:
Verificando a estrutra do atributo voc√™ ver√° que s√≥ est√° acess√≠vel nessa rela√ß√£o o GUID, ent√£o ser√° necess√°rio¬†acessar mais uma rela√ß√£o, a¬†‚ÄòBTStatusHAll‚Äô¬†para ent√£o chegar aos dados que desejamos:
At√© ai tudo lindo‚Ä¶ent√£o voc√™ me pergunta: ‚ÄúO que eu fa√ßo com isso???‚Äù
Simples meu amigo: voc√™ deve chamar o m√©todo GET_RELATED_ENTITIES a partir do seu objeto passando o nome das rela√ß√£o, essa a√ß√£o deve se repetir at√© que voc√™ chegue ao objeto que tem¬†informa√ß√£o que deseja‚Ä¶N√£o entendeu??? Ok , ent√£o veja o exemplo do c√≥digo para o cen√°rio que estamos analisando neste post:
*** Objetos
  DATA: lo_entity        TYPE REF TO cl_crm_bol_entity,
        lo_header_status TYPE REF TO if_bol_entity_col,
        lo_header_stat   TYPE REF TO cl_crm_bol_entity,
        lo_status_curr   TYPE REF TO if_bol_entity_col,
        lo_status        TYPE REF TO cl_crm_bol_entity.

***Estruturas
  DATA: lwa_admin_h      TYPE crmt_orderadm_h_wrk,
        lwa_status       TYPE crmst_status_btil.

* Obt√©m o AdminH-Entity com os dados do header do documento
  lo_entity ?= me->typed_context->btadminh->collection_wrapper->get_current( ).

  IF lo_entity IS BOUND.

* Busca a primeira rela√ß√£o de Status
    lo_header_status = lo_entity->get_related_entities(
                                      iv_relation_name = 'BTHeaderStatusSet' ).

    IF lo_header_status IS BOUND.

      lo_header_stat   = lo_header_status->get_first( ).

*     Busca a segunda rela√ß√£o, obtendo ent√£o o objeto com os dados que desejamos
      lo_status_curr = lo_header_stat->get_related_entities(
                                           iv_relation_name = 'BTStatusHCurrent' ).

      IF lo_status_curr IS BOUND.

        lo_status      = lo_status_curr->get_first( ).

        IF lo_status IS BOUND.

*         Obt√©m os valores de status existente no objeto atribuindo-os a estrutura
          lo_status->get_properties( IMPORTING
                                         es_attributes = lwa_status ).

          IF NOT lwa_status IS INITIAL AND
*** Agora chegamos as informa√ß√µes de status, ent√£o fica f√°cil basta dar
*** continuidade a l√≥gica aqui e ser feliz =D
            ENDIF.

          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDIF.
Ent√£o √© isso ai pessoal, espero que possa ter ajudado, deixem suas d√∫vidas, sugest√µes, cr√≠ticas, etc‚Ä¶Se eu n√£o gostar eu n√£o aceito‚Ä¶haha üòõ
E pra fechar vai a frase do dia:
A alegria evita mil males e Prolonga a vida.
William Shakespeare
XOXO.



Coment√°rios:
Rafael Paes Indiano (24/02/2015 12:06): OI Pri‚Ä¶ caramba est√£o pedindo bastante esse bol ultimamente‚Ä¶ n√£o sei nada e to tentando aprender pela net pois estou dispon√≠vel no momento e o mercado t√° foda ( se algu√©m souber de algo, to a√≠) valeu pelo post abra√ßos
Thiago Losilla (22/02/2011 08:54): Quase Primeiro‚Ä¶ Borman Coxinha!! X@ Ae Pri‚Ä¶. curti pra caramba o post meu, explicou certinho o esquema de buscar valores no n√≥ de contexto. Tenta ver depois o esquema de setar valores!! Valew!!!
Erik Bormann (22/02/2011 08:50): √â isso a√≠, quanto mais voc√™ aprender sobre Relacionamentos BOL, mais voc√™ desaprende sobre os relacionamentos pessoais. hahah‚Ä¶