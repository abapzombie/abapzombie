ABAPZombie Guide to ABAP ‚Äì Parte 14 ‚Äì AUTHORITY-CHECK
Autor: Mauricio Cruz
Data: 24/02/2011 08:30

E agora, o comando que voc√™ j√° xingou um dia (talvez at√© sem saber): o
AUTHORITY-CHECK
.
E o que ele faz? Verifica autoriza√ß√µes, d√£r. üôÑ
Bom, existem v√°rias maneiras de controlar o acesso dos usu√°rios √†s coisas do SAP, e uma delas √© atrav√©s de
Objetos de Autoriza√ß√£o
. Atrav√©s deles, voc√™ consegue controlar/segmentar o acesso do usu√°rio em qualquer tipo de programa.
NA transa√ß√£o
SU21
voc√™ pode ver a lista de objetos de autoriza√ß√£o do seu sistema, e at√© criar um novo. A associa√ß√£o de objetos de autoriza√ß√£o aos usu√°rios √© feita pelo time de perfil/basis, e voc√™ consegue analisar pelos perfis do usu√°rio, na SU01 (essa √© a mais simples, tem um monte de transa√ß√µes de perfis e controles de acesso).
Enfim, vamos ao exemplo:
REPORT zombie_authority_check.

SELECTION-SCREEN BEGIN OF BLOCK bl01.

  PARAMETER: p_werks TYPE t001w-werks.

SELECTION-SCREEN END OF BLOCK bl01.

*--------------------------------------------------------------------*
* START-OF-SELECTION
*--------------------------------------------------------------------*
START-OF-SELECTION.

* Verificando a Autoriza√ß√£o do User!
AUTHORITY-CHECK OBJECT 'S_WERKS'
  ID 'WERKS' FIELD p_werks  "C√≥digo do Centro
  ID 'BUKRS' DUMMY          "Ignora Campo
  ID 'ACTVT' FIELD '02'.    "Altera√ß√£o

CASE sy-subrc.
  WHEN 0.
*   Parab√©ns, voc√™ tem autoriza√ß√£o!
  WHEN 4.
*   X√¥ safado, n√£o tem autoriza√ß√£o = n√£o roda o programa!
  WHEN 12.
*   Das duas uma: ou o user n√£o tem esse obj associado, ou o obj
*   n√£o existe!
  WHEN OTHERS.
ENDCASE.
Ou seja, para criar uma verifica√ß√£o, voc√™ precisa saber os campos que o Objeto possue e o tipo de atividade que o usu√°rio vai executar (se o campo ACTVT estiver no objeto, √© claro). O sy-subrc da checagem pode indicar v√°rias coisas, como mostrado ali no exemplo.
No meu exemplo, eu tenho o objeto S_WERKS, que possue tr√™s campos que devem ser verificados: WERKS, BUKRS e ACTVT. Eu quis verificar o valor somente para o WERKS, deixando o valor de BUKRS n√£o relevante para a checagem. O campo ACTVT indica o tipo de atividade (veja os tipos na tabela TACT).
Caso voc√™ execute uma transa√ß√£o e apare√ßa a mensagem ‚Äúsem autoriza√ß√£o‚Äù, abra em outra janela a transa√ß√£o
SU53
, para entender o que aconteceu. Ela ir√° mostrar o log da √∫ltima verifica√ß√£o de autoriza√ß√£o feita para o seu usu√°rio.
Uma variante do comando:
DATA l_user TYPE sy-uname.

l_user = 'MRCRUZ'.

* Verificando a Autoriza√ß√£o do User!
AUTHORITY-CHECK OBJECT 'S_WERKS' FOR USER l_user
  ID 'WERKS' FIELD p_werks  "C√≥digo do Centro
  ID 'BUKRS' DUMMY          "Ignora Campo
  ID 'ACTVT' FIELD '02'.    "Altera√ß√£o
Com o FOR USER, voc√™ for√ßa a verifica√ß√£o somente para um usu√°rio espec√≠fico.
Bom, √© isso! Esse comando √© simples e faz TODA a diferen√ßa para o neg√≥cio da empresa. Evita que gente mal intencionada de fa√ßa coisas n√£o permitidas, e tamb√©m evita que pangu√°s desavisados causem com o sistema.
Ah, e tamb√©m atrapalha ABAPs e funcionais nas an√°lises de erros. üòÄ
Neste post
, eu comentei sobre o relacionamento entre o Authority-Check e o Call Transaction. Vale a pena dar uma olhada! üòÄ
AUTHORITY-CHECK
: Eternamente √∫til para a empresa, eternamente xingado para consultores.
Abra√ßos!



Coment√°rios:
C√°ssio (10/02/2012 09:53): Parab√©ns pelo site, cheio de bom humor e informa√ß√µes √∫teis.