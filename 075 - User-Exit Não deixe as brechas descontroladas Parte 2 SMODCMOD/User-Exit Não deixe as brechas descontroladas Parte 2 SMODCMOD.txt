User-Exit ‚Äì N√£o deixe as brechas descontroladas ‚Äì Parte 2 ‚Äì SMOD/CMOD
Autor: Mauricio Cruz
Data: 20/06/2011 11:14

Dando continuidade √† sequ√™ncia de posts que come√ßou
aqui
, hoje vamos desvendar mais uma maneira de colocar sua l√≥gica
trava sistemas
salva-vidas no meio do processamento Standard. Com voc√™s, SMOD/CMOD!
Voc√™ que j√° leu outros artigos do ABAPZombie deve estar acostumado: n√≥s tentamos informar de uma maneira divertida, provendo meios para voc√™ se apronfundar no assunto, caso tenha interesse. Portanto, vou ir direto ao ponto: esta sequ√™ncia de artigos n√£o foi feita para explicar em detalhes os motivos que levaram a SAP a criar as mil-e-uma maneiras de implementar user-exits no SAP, a id√©ia √© explicar como utilizar essas diversas t√©cnicas.
Mas, se voc√™ for um freak por conhecimento,
leia isso aqui
, e fa√ßa sucesso com as garotinhas(os) sap-geeks do mundo (boa sorte tentando encontrar essa ra√ßa).
Enfim, o que diabos s√£o SMOD e CMOD? Transa√ß√µes, √© claro! Elas trabalham em conjunto para que voc√™ possa criar
Projetos Z para agrupar Amplia√ß√µes e os seus Componentes
. A√≠ voc√™ pensa, mas heim? Vamos com calma üòÄ
Transa√ß√£o SMOD:
Aqui voc√™ tem acesso √† todas as
amplia√ß√µes
que a SAP prov√™ para que voc√™ possa colocar seu c√≥digo Z no meio do processamento Standard. Nessa transa√ß√£o voc√™ tamb√©m pode acessar todos os
componentes de uma amplia√ß√£o
, que s√£o as fun√ß√µes, √°reas de telas, includes e etc, onde voc√™ vai codificar de verdade.
Transa√ß√£o CMOD:
Onde voc√™ ir√° criar um novo projeto, que pode agrupar v√°rias amplia√ß√µes.
Ainda est√° confuso? T√°, eu desenho:
Sacou? Projeto -> Amplia√ß√µes -> Componentes (C√≥digo Z)
Vamos agora fazer um exemplo pr√°tico. Vamos supor que eu queria colocar c√≥digo em uma exit de Ordens de Vendas. Tenho ent√£o, que seguir alguns passos:
1) Encontrar a User-Exit:
Esse passo √© o mais cruel de todos, muitos ABAPers sofrem para encontrar User-Exits. No caso de exists atreladas √† amplia√ß√µes da SMOD, voc√™ pode fazer o seguinte:
‚Äì Dar um /H no standard, e colocar um break-point no comando
CALL CUSTOMER-FUNCTION
. Esse comando √© o que chama as fun√ß√µes registradas como componentes em aplia√ß√µes da SMOD.
‚Äì Usar o
F4 da SMOD
. Parece besta, mas eu j√° encontrei coisas aqui em minutos, utilizando ali o texto breve. Um *vendas* vai me trazer algumas amplia√ß√µes de SD, e √© uma delas que eu vou usar no exemplo deste artigo. No dia-a-dia, se voc√™ colocar uma palavra chave e ter sorte, voc√™ pode encontrar a exit que procura! üòÄ
Essa √© a Tela do F4 da SMOD. Clicando no ‚Äù + ‚Äù ao lado do fechar‚Ä¶
‚Ä¶voc√™ pode ver mais campos para busca. Eu achei a Amplia√ß√£o do nosso evento colocando a m√°scara *vendas* e dando um Ok (enter)
Tem ainda outros meios, e eu irei fazer um post sobre isso no futuro.
Vou usar a amplia√ß√£oV45P0001 de SD para nosso exemplo.
2) Criar o Projeto na CMOD:
Voc√™ deve criar um projeto Z para agrupar amplia√ß√µes. Fa√ßa o seguinte:
Acesse a transa√ß√£o SMOD, d√™ um nome Z para o projeto.
Clique em Criar, coloque um nome, d√™ um pacote e etcs. Salve atribua uma request e etcs. E etcs, etcs, etcs‚Ä¶¬†Projeto criado? Ent√£o temos que‚Ä¶
3) Adicionar as amplia√ß√µes da SMOD:
Dentro da tela do Projeto, clique em modificar, e depois em ‚ÄúAmplia√ß√£o atribui√ß√£o‚Äù
Exibi√ß√£o do Projeto ap√≥s a cria√ß√£o. Clicar no bot√£o destacado, com a descri√ß√£o Mestre YODA-Style
Aqui, vamos colocar a amplia√ß√£o que encontramos na SMOD e Salvar.
4) Implementar os componentes da amplia√ß√£o:
Ainda dentro da tela de amplia√ß√µes do seu projeto, coloque a linha sobre a amplia√ß√£o que acabamos de inserir e clique em ‚ÄúComponentes‚Äù. Voc√™ vai ver a tela abaixo:
Vamos colocar um c√≥digo nesse componente. Um duplo-clique no nome da ‚ÄúExit da Fun√ß√£o‚Äù, vai te levar pra essa tela aqui:
Viu ali o nome de uma include Z? Apesar de ela estar codificada, ela ainda n√£o existe. Vamos cri√°-la:
Opaaa mas pera√≠.. voc√™ deu o duplo-clique e ele n√£o criou? Apareceu essa mensagem em amarelo? Eu vou te responder: E DA√ç QUE APARECEU EM AMARELO? √â WARNING, APERTE ENTER E CONTINUE COM O PROCESSO. Desculpem o rage caps lock, mas por v√°rias vezes eu tive que explicar pra pessoas que trabalham com SAP h√° mais de 2 anos que mensagens de warning s√£o AVISOS, voc√™ l√™, entende, compreende, guarda na mem√≥ria e depois aperta ENTER e continua com a sua vida, feliz e contente. Voltando √† nossa include Z‚Ä¶
Depois de criar a INCLUDE, voc√™ pode colocar o c√≥digo que voc√™ quiser, de prefer√™ncia dentro de um IF para seu usu√°rio, de modo que o seu c√≥digo n√£o atrapalhe a vida de ningu√©m que n√£o seja voc√™ mesmo:
Voltando √† tela de Componentes dentro do seu projeto, voc√™ vai ver uma tela assim:
Note que o ‚ÄúImpl‚Äù agora tem um check verde, indicando que aquela exit tem um c√≥digo.¬†Notou tamb√©m que tem bot√µes de Ativar ali? Pois √© aqui que voc√™ vai ver a magia dessa baga√ßa toda: voc√™ pode ativar/desativar componentes indivualmente em suas amplia√ß√µes. Cool, fala√≠? Agora se o seu c√≥digo for destruir a produ√ß√£o, √© s√≥ desativar e todo mundo fica feliz denovo üòõ
5) Ativando sua implementa√ß√£o Z:
Clique na linha da Exit da Fun√ß√£o que criamos ali em cima, e clique no bot√£o de Ativar. Voc√™ ver√° a tela abaixo:
Que indica que voc√™ est√° pronto para testar o c√≥digo Z que voc√™ criou dentro da transa√ß√£o standard VA01.
E pronto, agora √© pura divers√£o no SAP üòÄ
Bom galera, esse foi um overview de como a CMOD/SMOD s√£o estruturadas, e de como implementar uma exit organizada nessas transa√ß√µes. Se voc√™ prestou aten√ß√£o, viu que na parte de componentes, n√£o temos s√≥ fun√ß√µes, temos tamb√©m includes e √°reas de tela. O processo para implementar √© praticamente o mesmo, mas, qualquer d√∫vida, poste nos coment√°rios que vamos tentar ajudar, ok?
Abra√ßos!



Coment√°rios:
Jailson (14/09/2021 07:59): Muito bom!! Obrigado pela desmistifica√ß√£o do tema!
Marcelo (12/08/2020 16:23): Muito bom! Valeu pela ajuda!
Celson Ramos Neves (23/05/2016 11:07): Fiz todo o procedimento, por√©m, quando transporto para o ambiente de qualidade, as amplia√ß√µes criadas na SMOD n√£o est√£o na CMOD, apesar da include existir ativa. Para inserir as amplia√ß√µes da SMOD na CMOD em qualidade √© somente por ambiente?
aline canteiro (18/02/2016 15:28): Muito obrigada ^^ sempre salvando !
Priscila Ramos (31/01/2014 16:28): Dica para achar o nome da aplica√ß√£o pela SMOD (com o nome da EXIT); Acesse a aba de caracter√≠sticas da exit(SE37), em dados gerais copie o nome do pacote e informe no help(F4) da SMOD.  Exemplo: EXIT (EXIT_SAPLRHIN_001) Pacote (SP00) Amplia√ß√£o (RHIV0001). Pri üôÇ
Carlos Melo (15/07/2013 15:03): Parabens, pessoal‚Ä¶.
Bruno Vianna (15/01/2013 14:53): Muito bom post Maur√≠cio me ajudou muito, obrigado.
Vinicius Ostan (13/10/2011 12:56): Quero agradecer novamente, Este post virou referencia quando esque√ßo de algum pequeno passo ao implementar exit.
Vinicius ostan (04/07/2011 07:46): Muito bom Mauricio, √≥timo post, Ajudou de +++ !!!
Renato Bonini (22/06/2011 06:52): Maurici√£o‚Ä¶. salvando algumas pessoas‚Ä¶ S√≥ pr√° adicionar outro modo de encontrar user EXIT, que eu acho muito simples e r√°pido, √© pegar o programa Base de uma Transa√ß√£o e fazer uma busca na SE37. Por exemplo: transa√ß√£o VA01 ‚Äì programa base SAPMV45A (Voc√™ pode pegar este programa pela SE93). Entra na SE37 e faz uma busca usando pelo nome da fun√ß√£o com "*SAPMV45A*". Todas as fun√ß√µes que retornarem "EXIT_xxxxxx" s√£o EXITs que voc√™ pode utilizar. Exemplo do retorno desta busca: XOIK                           IS-Oil TAS/TPI user exits EXIT_SAPMV45A_910              IS-OIL/TAS: Exit Change-Flag Output determination EXIT_SAPMV45A_911              TAS ‚Äì Customer exit after creation of calloff EXIT_SAPMV45A_920              User Exit: TAS data Incompletion Log on Doc.-header-level EXIT_SAPMV45A_930              Userexit to allow overdelivery in Quantity schedule XVVA                           User Exit Order EXIT_SAPMV45A_001              User Exit for Determining the Billing Plan Type EXIT_SAPMV45A_002              Preassignment of Sold-to Party in Sales Documents EXIT_SAPMV45A_003              Rev.Rec.: Copy Requirements An Header Level EXIT_SAPMV45A_004              Rev.Rec.: Field Modification Sales EXIT_SAPMV45A_005              Copyy Packing Proposal Into Outobund Delivery Orders
  Mauro Laranjeira (22/06/2011 09:15): Opa.. Valeu Bonini, toda contribui√ß√£o √© sempre bem vinda XD Abra√ßos
  Mauro Laranjeira (22/06/2011 09:15): Opa.. Valeu Bonini, toda contribui√ß√£o √© sempre bem vinda XD Abra√ßos