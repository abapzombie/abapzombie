SeleÃ§Ã£o com Query Dinamica â€“ BOL
Autor: Mauro Laranjeira
Data: 17/02/2012 15:43

â€“ Fazer uma consulta de documentoâ€¦
â€“ FÃ¡cil
â€“ SEM comando SELECTâ€¦
A partir do CRM 6.0, existe uma maneira diferente de fazermos nossas seleÃ§Ãµes de documentos, podemos utilizar a camada BOL para a busca.
Na transaÃ§Ã£o GENIL_BOL_BROWSER, podemos testar as buscas:
Entre na TransaÃ§Ã£o GENIL_MODEL_BROWSER, em SET DE COMPONENTES preencha
ALL
Teste de Query na TransaÃ§Ã£o GENIL_BOL_BROWSER
O objetivo deste teste foi buscar todas as Ordens de ServiÃ§o de um determinado parceiro deÂ negÃ³cios.
Para este processo utilizo a QueryÂ DinÃ¢mica
BTQSrvOrd
.
Tudo lindo, como seria isso via cÃ³digo:
DATA: o_query       TYPE REF TO cl_crm_bol_dquery_service,
        o_col_entity  TYPE REF TO if_bol_entity_col,
        o_entity      TYPE REF TO cl_crm_bol_entity.

  "Pega a instancia do objeto de pesquisa
  o_query = cl_crm_bol_dquery_service=>get_instance( 'BTQSrvOrd' ).

  "Preenche os parÃ¢metros de seleÃ§Ã£o
  o_query->add_selection_param( iv_attr_name = 'BU_PARTNER'
                                   iv_sign      = 'I'
                                   iv_option    = 'EQ'
                                   iv_low       = '0000000000' ). "NÃºmero do BP

  "Executa a busca e retorna uma coleÃ§Ã£o de entities
  "ou seja, todos os documentos encontrados
  o_col_entity = o_query->get_query_result( ).
Para navegarmos em cada objeto encontrado podemos usar:
"Pega a primeira entity do resultado da pesquisa
  o_entity = o_col_entity->get_first( ).

  "Entity instanciada?
  WHILE o_entity IS BOUND.

//Toda a logica com a entity

    "Pega a prÃ³xima entity do resultado da pesquisa
    o_entity = o_col_entity->get_next( ).

  ENDWHILE.
Neste post nÃ£o vou explicar como fazer a navegaÃ§Ã£o nas entidades do BOL, para isto temos o
post
da Priscila.
AbraÃ§os para toda Zombizada!!!!



ComentÃ¡rios:
Anderson Balieiro (26/11/2015 17:05): Muito bom mauro. Apenas complementando que caso a busca seja em um modelo que nÃ£o tenha â€œPesquisa ampliadaâ€ (exemplo BuilHeaderSearch) serÃ¡ necessario usar a seguinte classe: o_query = cl_crm_bol_query_service=>get_instance( â€˜BuilHeaderSearchâ€™ ). o_query->set_property( iv_attr_name = â€˜PARTNERâ€™ iv_value = vl_partner ).
  Mauro Laranjeira (01/12/2015 12:11): Exato, para query simples. Basicamente muda a classe de controle: cl_crm_bol_query_service â€“ Para query simples cl_crm_bol_dquery_service â€“ Para query dinÃ¢mica Como a query dinÃ¢mica permite repetiÃ§Ã£o para os parÃ¢metros de busca, o mÃ©todo utilizado Ã© outro add_selection_param. Vlw manu ğŸ˜‰ AbraÃ§Ã£o
  Mauro Laranjeira (01/12/2015 12:11): Exato, para query simples. Basicamente muda a classe de controle: cl_crm_bol_query_service â€“ Para query simples cl_crm_bol_dquery_service â€“ Para query dinÃ¢mica Como a query dinÃ¢mica permite repetiÃ§Ã£o para os parÃ¢metros de busca, o mÃ©todo utilizado Ã© outro add_selection_param. Vlw manu ğŸ˜‰ AbraÃ§Ã£o