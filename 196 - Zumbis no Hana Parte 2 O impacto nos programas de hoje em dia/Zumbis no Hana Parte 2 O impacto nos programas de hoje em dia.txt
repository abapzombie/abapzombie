Zumbis no Hana â€“ Parte 2 â€“ O impacto nos programas de hoje em dia
Autor: Mauricio Cruz
Data: 09/10/2014 11:11

Na segunda semana do curso da OpenSAP, os instrutores tentaram mostrar qual o impacto de uma migraÃ§Ã£o para o HANA nos programas de hoje em dia e explicaram quais ferramentas existem para ajudar-nos no processo de re-validaÃ§Ã£o de cÃ³digos Z (para saber se nenhum deles â€œquebrarÃ¡â€ com a implantaÃ§Ã£o do HANA). Antes de eu deixer as minhas consideraÃ§Ãµes (jÃ¡ que nÃ£o curti muito essa semana nÃ£o), vamos ao que foi explicado.
A pergunta do milhÃ£o: como fica o que jÃ¡ existe?
Essa Ã© a pergunta que 64 em cada 33 ABAPers fazem ao escutarem falar sobre o HANA. A parte boa Ã© que praticamente tudo que vocÃª jÃ¡ sabe (ou deveria saber) sobre guidelines e boas prÃ¡ticas de performance continuam valendo, ou seja,
nada de pensar que â€œsÃ³ porque tÃ¡ no HANA o SELECT em LOOP tÃ¡ liberadoâ€
. Â Continue seguindo os guidelines de sempre, obrigado.
PorÃ©m hÃ¡ algumas pequenas coisas que serÃ£o diferentes se o sistema tiver o HANA instalado:
SQL Nativo:
Manja aquele comando â€œEXEC SQLâ€? NÃ£o? EntÃ£o olhe
este link
.Â O SQL Nativo, como o prÃ³prio nome sugere, permite que vocÃª utilize comando
especÃ­ficos
de um determinado banco de dados. Se vocÃª utilizou algum comando especÃ­fico do banco de dados que foi substituÃ­do pelo HANA, aqueles comandos nÃ£o irÃ£o mais funcionar apÃ³s a migraÃ§Ã£o (master of the obvious).
HINTs especÃ­ficos do Banco de Dados:
Manja aquele â€œHINTSâ€ que a galera tem mania de enfiar nos SELECTs, utilizando de muleta para arrumar uma seleÃ§Ã£o cagada? EntÃ£o, o HANA vai ignorar esses HINTs que sugerem Ã­ndices que sÃ³ existiam no banco de dados substituÃ­do.
Partes onde vocÃª assumiu que o BD fosse se comportar de uma determinada forma:
Sem saber, algumas pessoas assumem que o banco de dados vai ser corportar de um jeito, e fazem seu programa em funÃ§Ã£o disso. Exemplo:Â assumir queÂ os dados de retorno de uma tabela sempre virÃ£o ordenados pelos campo chave. Isso muda com o HANA.
Vamos analisar um pouco mais o ponto que trarÃ¡ maior impacto, ou seja, o problema da ordenaÃ§Ã£o. No passado eu jÃ¡ vi algumas coisas bizarras acontecerem relacionadas a esse ponto, mas nunca havia entendido o motivo. Eu explico com cÃ³digo:
SELECT *
  FROM vbak
  INTO TABLE t_vbak.

READ TABLE t_vbak WITH KEY
  vbeln = '12345'
BINARY SEARCH
TRANSPORTING NO FIELDS.
E aÃ­, o READ TABLE.. BINARY SEARCH acima funciona? Muita gente irÃ¡ pensar â€œ
Ã© claro que funciona, VBELN Ã© a chave da VBAK, portanto, os dados virÃ£o ordenados por VBELNâ€
. Mas a realidade nÃ£o Ã© bem assim nÃ£o, camarada. No passado, eu jÃ¡ vi casos onde a tabela vinha desorganizada, sem controle nenhum de ordenaÃ§Ã£o implÃ­cito. Nunca consegui provar esse pqp quando mudava de projetos, pois na maioria dos lugares a tabela sempre vinhaÂ ordenada pelo chave primÃ¡ria, ou seja, pelo VBELN. Mas por que isso acontece?
Descobri nesse curo que isso depende do banco de dados. HÃ¡ certos BDs que entregam os dados para a aplicaÃ§Ã£o com uma ordenaÃ§Ã£o implÃ­cita, ou seja,Â a nÃ£o ser que vocÃª especifique a ordenaÃ§Ã£o pelo ORDER BY, o BD vai tentar entregar os dados ordenados pelaÂ chave primÃ¡ria. Mas nem todo BD funciona assimâ€¦ e o HANA Ã© um dos que nÃ£o garantem essa ordenaÃ§Ã£o.
Ao implantar o HANA, o BINARY SEARCH acima provavelmente falharia. A alternativa recomendada Ã© adicionar a clÃ¡usula ORDER BY no SELECT, especificando a ordenaÃ§Ã£o.
Pode parecer uma correÃ§Ã£o simples, mas pensa naÂ dor de cabeÃ§a que isso trarÃ¡ para a galera que fizer as migraÃ§Ãµes. CANSEI de ver esse tipo de coisa em cÃ³digos Zs mundo afora. Eu mesmo jÃ¡ tive minha Ã©poca de ignorar o SORT quando eu precisasse fazer algo com a chave primÃ¡ria, mas depois que vi aquele caso bizarro, nunca mais confieiâ€¦ (na verdade, fiquei feliz por descobrir que eu realmente nÃ£o estava maluco).
Prevejo hordas ABAPers dando manutenÃ§Ã£o em cÃ³digos, igual aquelas hordas que corrigiam errosÂ de unicode. Preparem-se!
Mas cara, vai ser impossÃ­vel analisar tudo que jÃ¡ existe!
Ã‰ exatamente por isso que a SAP vai lhe entregar ferramentas para ajudar nessas anÃ¡lises. Fica aqui a minha maior crÃ­tica a segunda semana do curso: muito blablabla sobre as ferramentas de anÃ¡lise, e poucos exemplos sobre como, de fato, o sistema irÃ¡ comportar-se apÃ³s a HANA.
Basicamente, a SAP adicionou algumas novas verificaÃ§Ãµes no Code Inspector, e criou algumas ferramentas para ajudar no monitoramento dos acessos ao banco de dados. JÃ¡ tem SE30, SAT, ST05â€¦ mas eles preferiram criar novas ferramentas, recriando as arquiteturas para que nÃ£o existam grandes impactos em anÃ¡lise de ambientes produtivos.
ValidaÃ§Ãµes EstÃ¡ticas:
Uma pancada de novos checks do Code Inspector, que eles estÃ£o monstrando como parte do
ABAP Test Cockpit,
jÃ¡ integrado no Eclipse para fazer as validaÃ§Ãµes. Todos esses checks visam alertar os desenvolvedores sobre os pontos de atenÃ§Ã£o e erros nos cÃ³digos que serÃ£o utilizados com o HANA. Essa Ã© uma ferramenta que deveria ser utilizada ANTES da Â migraÃ§Ã£o, para sanar os problemas antes do HANA ser implantado.
SQL Monitor:
A ST05 nÃ£o foi feita para analisar todo o ambiente, ela Ã© orientada a anÃ¡lises pontuais (e consome bastante recursos). Com o SQL Monitor, vocÃª pode ligar a anÃ¡lise em PRD por algum tempo e depois extrair esses dados e avaliar os pontos onde a performance estÃ¡ ruim. Uma coisa bacana Ã© que vocÃª pode extrair esses dados de PRD e importar no DEV ou QAS para ajudar nas correÃ§Ãµes. Ela foi desenvolvida para nÃ£o criar o caos na produÃ§Ã£o, jÃ¡ que o consumo de recursos para fazer as anÃ¡lises Ã© mÃ­nimo. VocÃª encontra uma descriÃ§Ã£o detalhada da ferramenta
neste link
.
SQL Performance Tunning Worklist
: E daÃ­ vocÃª pode pensar â€œputz, mais ferramentas separadas?â€. A SAP criou essa ferramenta de nome enome para combinar as funcionalidades das ValidaÃ§Ãµes EstÃ¡ticas e do SQL Monitor. Afinal, para que simplificar, nÃ£o Ã© verdade?
Com esse monte de ferramentas, ABAPer nenhum vai deixar seu cÃ³digo com baixa performance e incompatÃ­vel com o HANA!
â€¦
Certo?
ParafernÃ¡lias novas
Ficou um pouco desconexo com o resto do tema da semana, mas mostraram algumas novas features das versÃµes mais novas do ABAP quando integrado ao HANA.
Um novo formato de Search Help foi implantado. Uma imagem vale mais do que mil palavras para explicÃ¡-lo:
Auto-complete with steroids?
pic.twitter.com/nmhfBPINnj
â€” FlÃ¡vio Furlan (@furlan)
October 8, 2014
VocÃª configura esse novo tipo de Search Help pela SE11 mesmo. Funciona bem, achei bacana e para o usuÃ¡rio Ã© uma mÃ£o na roda!
No caso do ALV, eles mostraram o
ALV List Viewer with Integrated Data Access
, uma forma de criar e mostrar ALVs sem a lÃ³gico do SELECT to internal table > cria o containerÂ > cria a classe >Â bla,bla,bla,blaâ€¦
Basicamente o que vocÃª estiver vendo Ã© o que o SAP acabou de buscar no banco de dados. Conforme vocÃª dÃ¡ um PageDown/PageUp, o sistema vai atÃ© o banco de dados, busca os dados da nova pÃ¡gina e retorna isso para a tela. Ã‰ completamente diferente do que fazemos hoje em dia.
Aqui
tem uma comparaÃ§Ã£o interessante entre o modo â€œIDAâ€ e o modo â€œClÃ¡ssicoâ€, Â e mostra o quÃ£o diferente Ã© essa nova abordagem. Um vÃ­deozinho firmeza que mostra isso com mais detalhes:
Pensamentos randÃ´micos
Chegamos ao final de mais uma semana, e com ela surgem mais pensamentos randÃ´micos.
Posso estar viajando, mas essa histÃ³ria de usar um monte de coisas â€œnativasâ€ do HANA vai exigir profissionais que conheÃ§am muito bem como o HANA funciona. Pode ser que, no futuro, tenhamos mais uma camada de complexidade no projetos: o HANA Developer. O key user manda para o funcional, que manda para o ABAP, que pede para o cara do HANA fazer umas paradasâ€¦.
Sim, o cara do ABAP tambÃ©m pode fazer a parte de HANA. Mas acredito que, a longo prazo, o mais provavel Ã© que sejam trabalhos especializados feitos por pessoas diferentes, principalmente se levarmos em consideraÃ§Ã£o como funciona a dinÃ¢mica de estudo no nosso mercado.
Ah, e se tiver o Fiori fica ainda mais legal: Â O key-user fala com o funcional, que fala sei lÃ¡ com quem, que fala com o cara do Frontend, que fala com o ABAP, que fala com o cara de HANAâ€¦ ğŸ™‚
E assim termina a segunda parte dessa saga. Semana que vem tem mais!
DÃºvidas? Pensamentos randÃ´micos? Eu entendi alguma coisa errada e mereÃ§o ser xingado? Deixe um comentÃ¡rio!
AbraÃ§os a todos que acharam que o SELECT em LOOP seria o futuro!